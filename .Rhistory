# may need to fit for more iterations that this to get Rhat
# into a resonable range
fit <- stan("/tmp/model.stan",data=d, iter=10000, chains=4, init=init_f)
# may need to fit for more iterations that this to get Rhat
# into a resonable range
fit <- stan("~/Documents/GitHub/bayesian-methods/truncate_data.stan",data=d, iter=10000, chains=4, init=init_f)
plot(fit)
plot(stan_output)
plot(fit)
# may need to fit for more iterations that this to get Rhat
# into a resonable range
fit <- stan("~/Documents/GitHub/bayesian-methods/truncate_data.stan",data=d, iter=10000, chains=4, init=init_f)
d <- list(N_obs=n_obs,
N_cens=length(raw)-n_obs,
y_obs=censored,
U=rep(0.5,length(raw) - n_obs)
)
# there is no need for this (I think) if you can specify a lower
# bound on y_cens in the model.
# The maximal lower bound can be unknown, but if you know any
# lower bound that will help
init_f <- function() {
list(censored_threshold=0.5,d=0,y_cens=rep(1,length(raw) - n_obs), mu=0, sigma=1)
}
# may need to fit for more iterations that this to get Rhat
# into a resonable range
fit <- stan("~/Documents/GitHub/bayesian-methods/truncate_data.stan",data=d, iter=10000, chains=4, init=init_f)
d <- list(N_obs=n_obs,
N_cens=length(raw)-n_obs,
y_obs=censored,
censored_threshold=rep(0.5,length(raw) - n_obs)
)
# there is no need for this (I think) if you can specify a lower
# bound on y_cens in the model.
# The maximal lower bound can be unknown, but if you know any
# lower bound that will help
init_f <- function() {
list(censored_threshold=0.5,d=0,y_cens=rep(1,length(raw) - n_obs), mu=0, sigma=1)
}
# may need to fit for more iterations that this to get Rhat
# into a resonable range
fit <- stan("~/Documents/GitHub/bayesian-methods/truncate_data.stan",data=d, iter=10000, chains=4, init=init_f)
plot(fit)
fit
y <- model.response(model.frame(y~marital.happiness + age + no.years.married,data))
X <- model.matrix(y~marital.happiness + age + no.years.married, data)
U = 5
X_cens = subset(X, y > U)
X_obs = subset(X,y < U)
y_obs = subset(y,y < U)
K <- ncol(X)
stan_output <-stan(file = "~/Documents/GitHub/bayesian-methods/truncate_data.stan",
data= list(
N_obs = nrow(X_obs),
N_cens = nrow(X_cens),
K = K,
X_obs = X_obs,
X_cens = X_cens,
y_obs = y_obs,
U=U
),
iter = 100,
warmup = 50,
chains = 2)
stan_output <-stan(file = "~/Documents/GitHub/bayesian-methods/truncate_data.stan",
data= list(
N_obs = nrow(X_obs),
N_cens = nrow(X_cens),
K = K,
X_obs = X_obs,
X_cens = X_cens,
y_obs = y_obs,
U=U
),
iter = 1000,
warmup = 500,
chains = 2)
plot(stan_output)
stan_output
summary(stan_output, pars='mu')
summary(stan_output, pars="beta")
summary(stan_output, pars="beta","sigma")
summary(stan_output, pars="sigma")
summary(stan_output, pars=c("sigma","beta")
)
plot(summary(stan_output, pars=c("sigma","beta")))
summary(stan_output, pars=c("sigma","beta"))
k
K
X
summary(stan_output, pars=c("sigma","beta"))
summary(stan_output, pars="beta")
plot(summary(stan_output, pars="beta"))
stan_output['beta']
stan_output[100]
stan_output
stan_output$`beta[1]`
stan_output$beta[1]
plot(stan_output$`beta[1]`_
plot(stan_output$`beta[1]`)
plot(stan_output)
plot(stan_output, pars=c("beta","sigma"))
X
(stan_output, pars=c("beta","sigma"))
summary(stan_output, pars=c("beta","sigma"))
link?
link()
link(m5.4)
library(rethinking)
library(rstan)
library(rethinking)
library(rstan)
link()
link(stan_output)
d
# predictor residual plots
mu <- link(stan_output)
mu_mean <- apply(mu, 2, mean)
mu
mean
mu
R code 5.13
m5.4 <- quap( alist(
M ~ dnorm( mu , sigma ) , mu <- a + bAM * A ,
a ~ dnorm( 0 , 0.2 ) , bAM ~ dnorm( 0 , 0.5 ) , sigma ~ dexp( 1 )
) , data = d )
N <- 50 # number of simulated States age <- rnorm( N ) # sim A mar<-rnorm(N,-age) #simA->M div<-rnorm(N,age) #simA->D
R code 5.13
m5.4 <- quap( alist(
M ~ dnorm( mu , sigma ) , mu <- a + bAM * A ,
a ~ dnorm( 0 , 0.2 ) , bAM ~ dnorm( 0 , 0.5 ) , sigma ~ dexp( 1 )
) , data = d )
plot(stan_output, pars=c("beta", "sigma"))
stan_output
summary(stan_output, pars=c("beta", "sigma"))
# predictor residual plots
mu <- link(stan_output)
mu_mean <- apply(mu, 2, mean)
mu
link?
link()?
help(link)
link(stan_output)
link(stan_output)[0]
link(stan_output)[1]
setwd("~/Documents/GitHub/thesis")
source("~/Documents/GitHub/thesis/analysis.R")
data <- read_excel("true_pairs.xlsx", col_types='guess')
data$Difference = data$`Yield ask, at issue_SLB` - data$`Yield ask, yas_CB`
stay <- c("Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BGG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
View(data)
View(data)
data = data[,(names(data) %in% stay)]
data <- read_excel("true_pairs.xlsx", col_types='guess')
data$Difference = data$`Yield ask, at issue_SLB` - data$`Yield ask, yas_CB`
stay <- c("Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BBG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
data = data[,(names(data) %in% stay)]
ifelse(data[is.na(d$`BBG Composite`)],"N.R.")
ifelse(data[is.na(data$`BBG Composite`)],"N.R.")
data
data <- read_excel("true_pairs.xlsx", col_types='guess')
data$Difference = data$`Yield ask, at issue_SLB` - data$`Yield ask, yas_CB`
stay <- c("Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BBG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
data = data[,(names(data) %in% stay)]
ifelse(data[is.na(data$`BBG Composite`)],"N.R.")
ifelse(data[is.na(data$`BBG Composite_SLB`)],"N.R.")
ifelse(is.na(data$`BBG Composite_SLB`),"N.R.")
ifelse(is.na(data$`BBG Composite_SLB`),"N.R.",data$`BBG Composite_SLB`)
data <- read_excel("true_pairs.xlsx", col_types='guess')
data$Difference = data$`Yield ask, at issue_SLB` - data$`Yield ask, yas_CB`
stay <- c("Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BBG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
data = data[,(names(data) %in% stay)]
ifelse(is.na(data$`BBG Composite_SLB`),"NR",data$`BBG Composite_SLB`)
data$`BBG Composite_SLB`
data$`BBG Composite_SLB`<-ifelse(is.na(data$`BBG Composite_SLB`),"NR",data$`BBG Composite_SLB`)
data$`BBG Composite_SLB`
data <- read_excel("true_pairs.xlsx", col_types='guess')
data$Difference = data$`Yield ask, at issue_SLB` - data$`Yield ask, yas_CB`
stay <- c("Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BBG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
data = data[,(names(data) %in% stay)]
data$`BBG Composite_SLB`<-ifelse(is.na(data$`BBG Composite_SLB`),"NR",data$`BBG Composite_SLB`)
#--- One-hot encoding
new_df <- data
new_df$"Cntry of Incorp_SLB" <- factor(new_df$"Cntry of Incorp_SLB", exclude=NULL)
new_df$"BICS Level 1_SLB"<- factor(new_df$"BICS Level 1_SLB", exclude=NULL)
new_df$`Mty Type_SLB` <- factor(new_df$`Mty Type_SLB`, exclude=NULL)
new_df$`Payment Rank_SLB` <- factor(new_df$`Payment Rank_SLB`, exclude=NULL)
new_df$`Coupon Type_SLB` <- factor(new_df$`Coupon Type_SLB`, exclude=NULL)
new_df$`BBG Composite_SLB` <- factor(new_df$`BBG Composite_SLB`, exclude=NULL)
model2 <- lm(Difference ~ `Cntry of Incorp_SLB` + `BICS Level 1_SLB` +
`Mty Type_SLB` + `Coupon Type_SLB` + `BBG Composite_SLB`+ iss_diff  + mty_diff +
size_diff, data=new_df)
new_df$iss_diff <- time_length(difftime(new_df$`Issue Date_SLB`, new_df$`Issue Date_CB`),"years")
new_df$mty_diff <- time_length(difftime(new_df$`Maturity_SLB`, new_df$`Maturity_CB`),"years")
new_df$size_diff <- new_df$`Amt Issued_SLB` / new_df$`Amt Issued_CB`
#------- lm
conts <- model.matrix(~.-1, data = new_df[, c("Cntry of Incorp_SLB", "BICS Level 1_SLB","Mty Type_SLB","Coupon Type_SLB")],
contrasts.arg = list(
`Cntry of Incorp_SLB` = contrasts(new_df$"Cntry of Incorp_SLB", contrasts = FALSE),
`BICS Level 1_SLB` = contrasts(new_df$"BICS Level 1_SLB", contrasts = FALSE),
`Mty Type_SLB` = contrasts(new_df$"Mty Type_SLB", contrasts = FALSE),
`Coupon Type_SLB` = contrasts(new_df$"Coupon Type_SLB", contrasts = FALSE)
))
model2 <- lm(Difference ~ `Cntry of Incorp_SLB` + `BICS Level 1_SLB` +
`Mty Type_SLB` + `Coupon Type_SLB` + `BBG Composite_SLB`+ iss_diff  + mty_diff +
size_diff, data=new_df)
anova(model2)
summary(model2)
slb=c(data$'Yield ask, at issue_SLB')
cb=c(data$'Yield ask, yas_CB')
d=c(data$Difference)
summary(slb)
summary(cb)
summary(d)
boxplot(slb,cb,xlab='Bond type',ylab='Yield at issue',names=c('SLB','CB'))
hist(slb,freq=FALSE, main='Histogram of SLB Yield at issue',xlab='Yield at issue')
hist(slb,freq=FALSE, main='Histogram of SLB Yield at Issue',xlab='Yield at Issue')
hist(cb, freq=FALSE, main='Histogram of CB Yield at Issue',xlab='Yield at Issue')
cb
hist(slb,freq=FALSE, main='Histogram of SLB Yield at Issue',xlab='Yield at Issue')
hist(cb, freq=FALSE, main='Histogram of CB Yield at Issue',xlab='Yield at Issue')
qqnorm(slb, main='SLB')
qqline(slb)
qqnorm(slb, main='QQ Plot for SLB Yield at Issue')
qqline(slb)
qqnorm(cb, main='QQ Plot for CBB Yield at Issue')
qqline(cb)
qqnorm(cb, main='QQ Plot for CB Yield at Issue')
qqline(cb)
qqnorm(d, main='QQ Plot for Yield Difference')
qqline(d)
shapiro.test(slb)
shapiro.test(cb)
shapiro.test(d) # normally distributed
# Rank sum
wilcox.test(slb,cb,paired=FALSE)
wilcox.test(slb,cb,paired=FALSE,alternative='less')
# Signed rank
wilcox.test(slb,cb,paired=TRUE)
wilcox.test(slb,cb,paired=TRUE,alternative='less')
residuals(model2)
plot(residuals(model2))
hist(residuals(model2),freq=FALSE) # no systematic trend
qqplot(residuals(model2))
qqnorm(residuals(model2))
qqnorm(residuals(model2),p='norm')
qqnorm(residuals(model2))
qqline(residuals(model2))
source("~/Documents/GitHub/thesis/analysis.R")
View(new_df)
data <- read_excel("true_pairs.xlsx", col_types='guess')
data$Difference = data$`Yield ask, at issue_SLB` - data$`Yield ask, yas_CB`
stay <- c("Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BBG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
data = data[,(names(data) %in% stay)]
data$`BBG Composite_SLB`<-ifelse(is.na(data$`BBG Composite_SLB`),"NR",data$`BBG Composite_SLB`)
slb=c(data$'Yield ask, at issue_SLB')
cb=c(data$'Yield ask, yas_CB')
d=c(data$Difference)
summary(slb)
summary(cb)
summary(d)
boxplot(slb,cb,xlab='Bond type',ylab='Yield at issue',names=c('SLB','CB'))
hist(slb,freq=FALSE, main='Histogram of SLB Yield at Issue',xlab='Yield at Issue')
hist(cb, freq=FALSE, main='Histogram of CB Yield at Issue',xlab='Yield at Issue')
qqnorm(slb, main='QQ Plot for SLB Yield at Issue')
qqline(slb)
qqnorm(cb, main='QQ Plot for CB Yield at Issue')
qqline(cb)
qqnorm(d, main='QQ Plot for Yield Difference')
qqline(d)
shapiro.test(slb)
shapiro.test(cb)
shapiro.test(d) # normally distributed
ks.test(slb,'pnorm')
ks.test(cb,'pnorm')
ks.test(d,'pnorm') # not normally distributed
# Rank sum
wilcox.test(slb,cb,paired=FALSE)
wilcox.test(slb,cb,paired=FALSE,alternative='less')
# Signed rank
wilcox.test(slb,cb,paired=TRUE)
wilcox.test(slb,cb,paired=TRUE,alternative='less')
#--- One-hot encoding
new_df <- data
new_df$"Cntry of Incorp_SLB" <- factor(new_df$"Cntry of Incorp_SLB", exclude=NULL)
new_df$"BICS Level 1_SLB"<- factor(new_df$"BICS Level 1_SLB", exclude=NULL)
new_df$`Mty Type_SLB` <- factor(new_df$`Mty Type_SLB`, exclude=NULL)
new_df$`Payment Rank_SLB` <- factor(new_df$`Payment Rank_SLB`, exclude=NULL)
new_df$`Coupon Type_SLB` <- factor(new_df$`Coupon Type_SLB`, exclude=NULL)
new_df$`BBG Composite_SLB` <- factor(new_df$`BBG Composite_SLB`, exclude=NULL)
new_df$iss_diff <- time_length(difftime(new_df$`Issue Date_SLB`, new_df$`Issue Date_CB`),"years")
new_df$mty_diff <- time_length(difftime(new_df$`Maturity_SLB`, new_df$`Maturity_CB`),"years")
new_df$size_diff <- new_df$`Amt Issued_SLB` / new_df$`Amt Issued_CB`
#------- lm
conts <- model.matrix(~.-1, data = new_df[, c("Cntry of Incorp_SLB", "BICS Level 1_SLB","Mty Type_SLB","Coupon Type_SLB")],
contrasts.arg = list(
`Cntry of Incorp_SLB` = contrasts(new_df$"Cntry of Incorp_SLB", contrasts = FALSE),
`BICS Level 1_SLB` = contrasts(new_df$"BICS Level 1_SLB", contrasts = FALSE),
`Mty Type_SLB` = contrasts(new_df$"Mty Type_SLB", contrasts = FALSE),
`Coupon Type_SLB` = contrasts(new_df$"Coupon Type_SLB", contrasts = FALSE)
))
model2 <- lm(Difference ~ `Cntry of Incorp_SLB` + `BICS Level 1_SLB` +
`Mty Type_SLB` + `Coupon Type_SLB` + `BBG Composite_SLB`+ iss_diff  + mty_diff +
size_diff, data=new_df)
anova(model2)
summary(model2)
plot(residuals(model2)) # plot each variable against residuals
hist(residuals(model2),freq=FALSE) # no systematic trend
qqnorm(residuals(model2))
View(data)
View(data)
data <- read_excel("true_pairs.xlsx", col_types='guess')
stay <- c("Issuer Name_SLB","Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BBG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
data <- read_excel("true_pairs.xlsx", col_types='guess')
data$Difference = data$`Yield ask, at issue_SLB` - data$`Yield ask, yas_CB`
stay <- c("Issuer Name_SLB","Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BBG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
data = data[,(names(data) %in% stay)]
data$`BBG Composite_SLB`<-ifelse(is.na(data$`BBG Composite_SLB`),"NR",data$`BBG Composite_SLB`)
slb=c(data$'Yield ask, at issue_SLB')
cb=c(data$'Yield ask, yas_CB')
d=c(data$Difference)
summary(slb)
summary(cb)
summary(d)
boxplot(slb,cb,xlab='Bond type',ylab='Yield at issue',names=c('SLB','CB'))
hist(slb,freq=FALSE, main='Histogram of SLB Yield at Issue',xlab='Yield at Issue')
hist(cb, freq=FALSE, main='Histogram of CB Yield at Issue',xlab='Yield at Issue')
qqnorm(slb, main='QQ Plot for SLB Yield at Issue')
qqline(slb)
qqnorm(cb, main='QQ Plot for CB Yield at Issue')
qqline(cb)
qqnorm(d, main='QQ Plot for Yield Difference')
qqline(d)
shapiro.test(slb)
shapiro.test(cb)
shapiro.test(d) # normally distributed
ks.test(slb,'pnorm')
ks.test(cb,'pnorm')
ks.test(d,'pnorm') # not normally distributed
# Rank sum
wilcox.test(slb,cb,paired=FALSE)
wilcox.test(slb,cb,paired=FALSE,alternative='less')
# Signed rank
wilcox.test(slb,cb,paired=TRUE)
wilcox.test(slb,cb,paired=TRUE,alternative='less')
#--- One-hot encoding
new_df <- data
new_df$"Cntry of Incorp_SLB" <- factor(new_df$"Cntry of Incorp_SLB", exclude=NULL)
new_df$"BICS Level 1_SLB"<- factor(new_df$"BICS Level 1_SLB", exclude=NULL)
new_df$`Mty Type_SLB` <- factor(new_df$`Mty Type_SLB`, exclude=NULL)
new_df$`Payment Rank_SLB` <- factor(new_df$`Payment Rank_SLB`, exclude=NULL)
new_df$`Coupon Type_SLB` <- factor(new_df$`Coupon Type_SLB`, exclude=NULL)
new_df$`BBG Composite_SLB` <- factor(new_df$`BBG Composite_SLB`, exclude=NULL)
new_df$iss_diff <- time_length(difftime(new_df$`Issue Date_SLB`, new_df$`Issue Date_CB`),"years")
new_df$mty_diff <- time_length(difftime(new_df$`Maturity_SLB`, new_df$`Maturity_CB`),"years")
new_df$size_diff <- new_df$`Amt Issued_SLB` / new_df$`Amt Issued_CB`
#------- lm
conts <- model.matrix(~.-1, data = new_df[, c("Cntry of Incorp_SLB", "BICS Level 1_SLB","Mty Type_SLB","Coupon Type_SLB")],
contrasts.arg = list(
`Cntry of Incorp_SLB` = contrasts(new_df$"Cntry of Incorp_SLB", contrasts = FALSE),
`BICS Level 1_SLB` = contrasts(new_df$"BICS Level 1_SLB", contrasts = FALSE),
`Mty Type_SLB` = contrasts(new_df$"Mty Type_SLB", contrasts = FALSE),
`Coupon Type_SLB` = contrasts(new_df$"Coupon Type_SLB", contrasts = FALSE)
))
model2 <- lm(Difference ~ `Cntry of Incorp_SLB` + `BICS Level 1_SLB` +
`Mty Type_SLB` + `Coupon Type_SLB` + `BBG Composite_SLB`+ iss_diff  + mty_diff +
size_diff, data=new_df)
anova(model2)
summary(model2)
plot(residuals(model2)) # plot each variable against residuals
hist(residuals(model2),freq=FALSE) # no systematic trend
qqnorm(residuals(model2))
qqline(residuals(model2)) # different types of data?
hist(d, freq=FALSE, main='Histogram of Yield Difference',xlab='Yield at Issue')
data <- read_excel("true_pairs.xlsx", col_types='guess')
data$Difference = data$`Yield ask, at issue_SLB` - data$`Yield ask, yas_CB`
stay <- c("Issuer Name_SLB","Issue Date_SLB","Maturity_SLB","Amt Issued_SLB","Cntry of Incorp_SLB",
"Cpn_SLB","Mty Type_SLB","Payment Rank_SLB", "ESG Rating_SLB","BBG Composite_SLB",
"Coupon Type_SLB","BICS Level 1_SLB",
"Step up desc_SLB","Step up_SLB","Step down_SLB","Step-up&down?_SLB","SPT _SLB",
"Yield ask, at issue_SLB","Issue Date_CB", "Maturity_CB",
"Amt Issued_CB","Cpn_CB",
"Yield ask, yas_CB","Difference")
data = data[,(names(data) %in% stay)]
data$`BBG Composite_SLB`<-ifelse(is.na(data$`BBG Composite_SLB`),"NR",data$`BBG Composite_SLB`)
slb=c(data$'Yield ask, at issue_SLB')
cb=c(data$'Yield ask, yas_CB')
d=c(data$Difference)
summary(slb)
summary(cb)
summary(d)
boxplot(slb,cb,xlab='Bond type',ylab='Yield at issue',names=c('SLB','CB'))
hist(slb,freq=FALSE, main='Histogram of SLB Yield at Issue',xlab='Yield at Issue')
hist(cb, freq=FALSE, main='Histogram of CB Yield at Issue',xlab='Yield at Issue')
hist(d, freq=FALSE, main='Histogram of Yield Difference',xlab='Yield at Issue')
qqnorm(slb, main='QQ Plot for SLB Yield at Issue')
qqline(slb)
qqnorm(cb, main='QQ Plot for CB Yield at Issue')
qqline(cb)
qqnorm(d, main='QQ Plot for Yield Difference')
qqline(d)
shapiro.test(slb)
shapiro.test(cb)
shapiro.test(d) # normally distributed
ks.test(slb,'pnorm')
ks.test(cb,'pnorm')
ks.test(d,'pnorm') # not normally distributed
# Rank sum
wilcox.test(slb,cb,paired=FALSE)
wilcox.test(slb,cb,paired=FALSE,alternative='less')
# Signed rank
wilcox.test(slb,cb,paired=TRUE)
wilcox.test(slb,cb,paired=TRUE,alternative='less')
#--- One-hot encoding
new_df <- data
new_df$"Cntry of Incorp_SLB" <- factor(new_df$"Cntry of Incorp_SLB", exclude=NULL)
new_df$"BICS Level 1_SLB"<- factor(new_df$"BICS Level 1_SLB", exclude=NULL)
new_df$`Mty Type_SLB` <- factor(new_df$`Mty Type_SLB`, exclude=NULL)
new_df$`Payment Rank_SLB` <- factor(new_df$`Payment Rank_SLB`, exclude=NULL)
new_df$`Coupon Type_SLB` <- factor(new_df$`Coupon Type_SLB`, exclude=NULL)
new_df$`BBG Composite_SLB` <- factor(new_df$`BBG Composite_SLB`, exclude=NULL)
new_df$iss_diff <- time_length(difftime(new_df$`Issue Date_SLB`, new_df$`Issue Date_CB`),"years")
new_df$mty_diff <- time_length(difftime(new_df$`Maturity_SLB`, new_df$`Maturity_CB`),"years")
new_df$size_diff <- new_df$`Amt Issued_SLB` / new_df$`Amt Issued_CB`
model2 <- lm(Difference ~ `Cntry of Incorp_SLB` + `BICS Level 1_SLB` +
`Mty Type_SLB` + `Coupon Type_SLB` + `BBG Composite_SLB`+ iss_diff  + mty_diff +
size_diff, data=new_df)
anova(model2)
summary(model)
model <- lm(Difference ~ `Cntry of Incorp_SLB` + `BICS Level 1_SLB` +
`Mty Type_SLB` + `Coupon Type_SLB` + `BBG Composite_SLB`+ iss_diff  + mty_diff +
size_diff, data=new_df)
anova(model)
summary(model)
plot(residuals(model)) # plot each variable against residuals
hist(residuals(model),freq=FALSE) # no systematic trend
qqnorm(residuals(model))
residuals(model)
new_df$`Cntry of Incorp_SLB`
table(new_df$`Cntry of Incorp_SLB`)
plot(table(new_df$`Cntry of Incorp_SLB`))
table(new_df$`BICS Level 1_SLB`)
table(new_df$`Mty Type_SLB`)
table(new_df$`Coupon Type_SLB`)
table(new_df$`BBG Composite_SLB`)
hist(new_df$iss_diff,freq=FALSE)
plot(new_df$iss_diff)
plot(new_df$mty_diff)
plot(new_df$size_diff)
table(new_df$`Issuer Name_SLB`)
plot(table(new_df$`Issuer Name_SLB`))
plot(new_df$`Issuer Name_SLB`)
plot(table(new_df$`Issuer Name_SLB`),residuals(model))
plot(table(new_df$`Issuer Name_SLB`))
plot(new_df$iss_dif,residuals(model))
residuals(model)
new_df$iss_diff
c(new_df$iss_diff,residuals(model))
library(ggplot)
install.packages('ggplot')
qplot(new_df$size_diff)
ghist(new_df$size_diff)
ggplot(new_df$size_diff)
ggplot(new_df)
